{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}


{% block content %}


<div class="row justify-content-center mt-5">
    <div class="col-11 col-md-9 ">

        <!--Tabs title-->
        <nav>
            <div class="nav nav-tabs h3 mb-5 p-4" id="nav-tab" role="tablist">
              <button
                class="nav-link col-6"
                id="nav-book-tab"
                data-bs-toggle="tab"
                data-bs-target="#nav-book"
                type="button"
                role="tab"
                aria-controls="nav-book"
                aria-selected="true"
              >
              <i class="fa-solid fa-utensils"></i> Book a Table
              </button>
              <button
                class="nav-link active col-6"
                id="nav-mybook-tab"
                data-bs-toggle="tab"
                data-bs-target="#nav-mybook"
                type="button"
                role="tab"
                aria-controls="nav-mybook"
                aria-selected="false"
              >
              <i class="fa-solid fa-list"></i>  My Bookings
              </button>
            </div>
        </nav>

          <!--Tabs Content-->
        <div class="tab-content " id="nav-tabContent">

            <!--Booking Form -->
            <div
              class="tab-pane fade"
              id="nav-book"
              role="tabpanel"
              aria-labelledby="nav-book-tab"
              tabindex="0"
              >
                <div class="container">
                    <div class="row justify-content-center">
                
                        <div class="card col-11 col-md-8 col-lg-7">
                            <h1 class="card-title text-center pt-4 mt-2">Book a Table</h1>
                            <div class="col-6 justify-content-center text-center mx-auto my-0"><hr></div>
                
                            <div class="px-3 mt-0">
                                {% if user.is_authenticated  %}
                                <form action="{% url 'book' %}" method = 'POST' class = 'mt-5'>
                                    {% csrf_token %}
                                    {{booking_form | crispy }}
                            
                                    <!--Form buttons-->
                                    <div class="text-end my-5">
                                        <button class="btn btn-outline-light col-5" type="submit">Book</button>
                                    </div>
                                </form>
                                {% else %}
                                    <div class="card p-4 m-2">
                                        <p class="h6 m-0 text-center">Log in first to be able to book a table</p>
                                        <div class="text-center my-5">
                                            <a href="{% url "account_login" %}" class="btn btn-outline-light col-5">Log in</a>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--My Bookings -->
            <div
                class="tab-pane fade show active"
                id="nav-mybook"
                role="tabpanel"
                aria-labelledby="nav-mybook-tab"
                tabindex="0">
                <div class="row justify-content-center">
                    <div class="card col-11 col-md-8 col-lg-7">
                        <h1 class="card-title text-center pt-4 mt-2">My Bookings</h1>
                        <div class="col-6 justify-content-center text-center mx-auto my-0"><hr></div>
                        <div>
                            {% if user.is_authenticated %}
                            {% for booking in bookings %}
                            {% if user.is_authenticated and booking.user == user %}
                            <p>
                            User: {{booking.user}} <br>
                            Name: {{booking.name}} <br>
                            Email: {{booking.email}} <br>
                            Phone: {{booking.phone}} <br>
                            Number of Guests : {{booking.guest_count}} <br>
                            Table : {{booking.table}} <br>
                            Booking Date: {{booking.requested_date}} <br>
                            Booking Time: {{booking.requested_time}} <br>
                            Booking created on: {{booking.created_date}} <br>
                            Booking status:<span class="badge 
                            {% if booking.status == 'Awaiting confirmation' %}
                            text-bg-secondary
                            {% elif booking.status == 'Booking Confirmed'%}
                            text-bg-success
                            {% elif booking.status == 'Booking Rejected'%}
                            text-bg-danger
                            {% elif booking.status == 'Booking Expired'%}
                            text-bg-warning
                            {% endif %}
                            ">
                            {{booking.status}} 
                            </span><br>
                            
                            <!--show edit and delete buttons-->
                            <div class="mt-5 justify-content-center text-center">
                                <button class="btn  btn-danger btn-delete col-4 col-lg-3" data-bs-toggle="modal" data-bs-target="#delete{{booking.id}}" >Delete</button>
                                <a class="btn btn-success btn-edit col-4 col-lg-3"  href= "{% url 'edit' booking.id %}">Edit</a>
                            </div>
                            <hr>

                            <!-- Modal - Delete Student -->
                            <div
                            class="modal"
                            id="delete{{ booking.id }}"
                            tabindex="-1"
                            aria-labelledby="bookingmodal"
                            aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="bookingmodal">
                                    Booking: {{ booking.name }} <br>
                                    </h5>
                                    <button
                                    type="button"
                                    class="btn-close"
                                    data-bs-dismiss="modal"
                                    aria-label="Close">
                                    <span aria-hidden="true"></span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <p>Are you sure you want to delete this booking:<strong>
                                        <br>
                                        Booking: {{ booking.name }} <br>
                                        Number of Guests : {{booking.guest_count}} <br>
                                        Table :{{booking.table}}<br>
                                        Booking Date: {{booking.requested_date}}<br>
                                    </strong></p>
                                </div>
                                <div class="modal-footer">
                                    <form action="{% url 'delete' booking.id %}" method="post">
                                    {% csrf_token %}
                                    <input type="submit" class="btn btn-danger " value="delete" style="color: aliceblue;">
                                    </form>
                                    <button
                                    type="button"
                                    class="btn btn-secondary"
                                    data-bs-dismiss="modal">
                                    Close
                                    </button>
                                </div>
                                </div>
                            </div>
                            </div>
                            {% endif %}
                            {% endfor %}
                            {% else %}
                            <div class="card p-4 m-2">
                                <p class="h6 m-0 text-center">Log in first to be able to see your bookings.</p>
                                <div class="text-center my-5">
                                    <a href="{% url "account_login" %}" class="btn btn-outline-light col-5">Log in</a>
                            </div>

                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}